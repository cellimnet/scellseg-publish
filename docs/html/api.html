

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Cellpose API Guide &mdash; cellpose 0.7.2 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Command line" href="command.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: black" >
          

          
            <a href="index.html" class="icon icon-home"> cellpose
          

          
            
            <img src="_static/favicon.ico" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Basics:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui.html">GUI</a></li>
<li class="toctree-l1"><a class="reference internal" href="inputs.html">Inputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="settings.html">Settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="outputs.html">Outputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="train.html">Training</a></li>
</ul>
<p class="caption"><span class="caption-text">Examples:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="notebook.html">In a notebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="command.html">Command line</a></li>
</ul>
<p class="caption"><span class="caption-text">API Reference:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Cellpose API Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#cellpose-class">Cellpose class</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cellposemodel">CellposeModel</a></li>
<li class="toctree-l2"><a class="reference internal" href="#sizemodel">SizeModel</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-cellpose.metrics">Metrics</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-cellpose.dynamics">Flows to masks</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-cellpose.transforms">Image transforms</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-cellpose.plot">Plot functions</a></li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">cellpose</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Cellpose API Guide</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/api.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <div class="rst-breadcrumbs-buttons" role="navigation" aria-label="breadcrumb navigation">
      
      
        <a href="command.html" class="btn btn-neutral float-left" title="Command line" accesskey="p"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
      
  </div>
  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="cellpose-api-guide">
<h1>Cellpose API Guide<a class="headerlink" href="#cellpose-api-guide" title="Permalink to this headline">¶</a></h1>
<div class="section" id="cellpose-class">
<span id="cpclass"></span><h2>Cellpose class<a class="headerlink" href="#cellpose-class" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="cellpose.models.Cellpose">
<em class="property">class </em><code class="sig-prename descclassname">cellpose.models.</code><code class="sig-name descname">Cellpose</code><span class="sig-paren">(</span><em class="sig-param">gpu=False</em>, <em class="sig-param">model_type='cyto'</em>, <em class="sig-param">net_avg=True</em>, <em class="sig-param">device=None</em>, <em class="sig-param">torch=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cellpose/models.html#Cellpose"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cellpose.models.Cellpose" title="Permalink to this definition">¶</a></dt>
<dd><p>main model which combines SizeModel and CellposeModel</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>gpu</strong> (<em>bool</em><em> (</em><em>optional</em><em>, </em><em>default False</em><em>)</em>) – whether or not to use GPU, will check if GPU available</p></li>
<li><p><strong>model_type</strong> (<em>str</em><em> (</em><em>optional</em><em>, </em><em>default 'cyto'</em><em>)</em>) – ‘cyto’=cytoplasm model; ‘nuclei’=nucleus model</p></li>
<li><p><strong>net_avg</strong> (<em>bool</em><em> (</em><em>optional</em><em>, </em><em>default True</em><em>)</em>) – loads the 4 built-in networks and averages them if True, loads one network if False</p></li>
<li><p><strong>device</strong> (<em>gpu device</em><em> (</em><em>optional</em><em>, </em><em>default None</em><em>)</em>) – where model is saved (e.g. mx.gpu() or mx.cpu()), overrides gpu input,
recommended if you want to use a specific GPU (e.g. mx.gpu(4) or torch.cuda.device(4))</p></li>
<li><p><strong>torch</strong> (<em>bool</em><em> (</em><em>optional</em><em>, </em><em>default False</em><em>)</em>) – run model using torch if available</p></li>
</ul>
</dd>
</dl>
<dl class="method">
<dt id="cellpose.models.Cellpose.eval">
<code class="sig-name descname">eval</code><span class="sig-paren">(</span><em class="sig-param">x</em>, <em class="sig-param">batch_size=8</em>, <em class="sig-param">channels=None</em>, <em class="sig-param">invert=False</em>, <em class="sig-param">normalize=True</em>, <em class="sig-param">diameter=30.0</em>, <em class="sig-param">do_3D=False</em>, <em class="sig-param">anisotropy=None</em>, <em class="sig-param">net_avg=True</em>, <em class="sig-param">augment=False</em>, <em class="sig-param">tile=True</em>, <em class="sig-param">tile_overlap=0.1</em>, <em class="sig-param">resample=False</em>, <em class="sig-param">interp=True</em>, <em class="sig-param">flow_threshold=0.4</em>, <em class="sig-param">cellprob_threshold=0.0</em>, <em class="sig-param">min_size=15</em>, <em class="sig-param">stitch_threshold=0.0</em>, <em class="sig-param">rescale=None</em>, <em class="sig-param">progress=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cellpose/models.html#Cellpose.eval"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cellpose.models.Cellpose.eval" title="Permalink to this definition">¶</a></dt>
<dd><p>run cellpose and get masks</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> (<em>list</em><em> or </em><em>array of images</em>) – can be list of 2D/3D images, or array of 2D/3D images, or 4D image array</p></li>
<li><p><strong>batch_size</strong> (<em>int</em><em> (</em><em>optional</em><em>, </em><em>default 8</em><em>)</em>) – number of 224x224 patches to run simultaneously on the GPU
(can make smaller or bigger depending on GPU memory usage)</p></li>
<li><p><strong>channels</strong> (<em>list</em><em> (</em><em>optional</em><em>, </em><em>default None</em><em>)</em>) – list of channels, either of length 2 or of length number of images by 2.
First element of list is the channel to segment (0=grayscale, 1=red, 2=blue, 3=green).
Second element of list is the optional nuclear channel (0=none, 1=red, 2=blue, 3=green).
For instance, to segment grayscale images, input [0,0]. To segment images with cells
in green and nuclei in blue, input [2,3]. To segment one grayscale image and one
image with cells in green and nuclei in blue, input [[0,0], [2,3]].</p></li>
<li><p><strong>invert</strong> (<em>bool</em><em> (</em><em>optional</em><em>, </em><em>default False</em><em>)</em>) – invert image pixel intensity before running network (if True, image is also normalized)</p></li>
<li><p><strong>normalize</strong> (<em>bool</em><em> (</em><em>optional</em><em>, </em><em>default True</em><em>)</em>) – normalize data so 0.0=1st percentile and 1.0=99th percentile of image intensities in each channel</p></li>
<li><p><strong>diameter</strong> (<em>float</em><em> (</em><em>optional</em><em>, </em><em>default 30.</em><em>)</em>) – if set to None, then diameter is automatically estimated if size model is loaded</p></li>
<li><p><strong>do_3D</strong> (<em>bool</em><em> (</em><em>optional</em><em>, </em><em>default False</em><em>)</em>) – set to True to run 3D segmentation on 4D image input</p></li>
<li><p><strong>anisotropy</strong> (<em>float</em><em> (</em><em>optional</em><em>, </em><em>default None</em><em>)</em>) – for 3D segmentation, optional rescaling factor (e.g. set to 2.0 if Z is sampled half as dense as X or Y)</p></li>
<li><p><strong>net_avg</strong> (<em>bool</em><em> (</em><em>optional</em><em>, </em><em>default True</em><em>)</em>) – runs the 4 built-in networks and averages them if True, runs one network if False</p></li>
<li><p><strong>augment</strong> (<em>bool</em><em> (</em><em>optional</em><em>, </em><em>default False</em><em>)</em>) – tiles image with overlapping tiles and flips overlapped regions to augment</p></li>
<li><p><strong>tile</strong> (<em>bool</em><em> (</em><em>optional</em><em>, </em><em>default True</em><em>)</em>) – tiles image to ensure GPU/CPU memory usage limited (recommended)</p></li>
<li><p><strong>tile_overlap</strong> (<em>float</em><em> (</em><em>optional</em><em>, </em><em>default 0.1</em><em>)</em>) – fraction of overlap of tiles when computing flows</p></li>
<li><p><strong>resample</strong> (<em>bool</em><em> (</em><em>optional</em><em>, </em><em>default False</em><em>)</em>) – run dynamics at original image size (will be slower but create more accurate boundaries)</p></li>
<li><p><strong>interp</strong> (<em>bool</em><em> (</em><em>optional</em><em>, </em><em>default True</em><em>)</em>) – interpolate during 2D dynamics (not available in 3D)
(in previous versions it was False)</p></li>
<li><p><strong>flow_threshold</strong> (<em>float</em><em> (</em><em>optional</em><em>, </em><em>default 0.4</em><em>)</em>) – flow error threshold (all cells with errors below threshold are kept) (not used for 3D)</p></li>
<li><p><strong>cellprob_threshold</strong> (<em>float</em><em> (</em><em>optional</em><em>, </em><em>default 0.0</em><em>)</em>) – cell probability threshold (all pixels with prob above threshold kept for masks)</p></li>
<li><p><strong>min_size</strong> (<em>int</em><em> (</em><em>optional</em><em>, </em><em>default 15</em><em>)</em>) – minimum number of pixels per mask, can turn off with -1</p></li>
<li><p><strong>stitch_threshold</strong> (<em>float</em><em> (</em><em>optional</em><em>, </em><em>default 0.0</em><em>)</em>) – if stitch_threshold&gt;0.0 and not do_3D and equal image sizes, masks are stitched in 3D to return volume segmentation</p></li>
<li><p><strong>rescale</strong> (<em>float</em><em> (</em><em>optional</em><em>, </em><em>default None</em><em>)</em>) – if diameter is set to None, and rescale is not None, then rescale is used instead of diameter for resizing image</p></li>
<li><p><strong>progress</strong> (<em>pyqt progress bar</em><em> (</em><em>optional</em><em>, </em><em>default None</em><em>)</em>) – to return progress bar status to GUI</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>masks</strong> (<em>list of 2D arrays, or single 3D array (if do_3D=True)</em>) – labelled image, where 0=no masks; 1,2,…=mask labels</p></li>
<li><p><strong>flows</strong> (<em>list of lists 2D arrays, or list of 3D arrays (if do_3D=True)</em>) – flows[k][0] = XY flow in HSV 0-255
flows[k][1] = flows at each pixel
flows[k][2] = the cell probability centered at 0.0</p></li>
<li><p><strong>styles</strong> (<em>list of 1D arrays of length 64, or single 1D array (if do_3D=True)</em>) – style vector summarizing each image, also used to estimate size of objects in image</p></li>
<li><p><strong>diams</strong> (<em>list of diameters, or float (if do_3D=True)</em>)</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="cellposemodel">
<h2>CellposeModel<a class="headerlink" href="#cellposemodel" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="cellpose.models.CellposeModel">
<em class="property">class </em><code class="sig-prename descclassname">cellpose.models.</code><code class="sig-name descname">CellposeModel</code><span class="sig-paren">(</span><em class="sig-param">gpu=False</em>, <em class="sig-param">pretrained_model=False</em>, <em class="sig-param">torch=True</em>, <em class="sig-param">diam_mean=30.0</em>, <em class="sig-param">net_avg=True</em>, <em class="sig-param">device=None</em>, <em class="sig-param">residual_on=True</em>, <em class="sig-param">style_on=True</em>, <em class="sig-param">concatenation=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cellpose/models.html#CellposeModel"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cellpose.models.CellposeModel" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>gpu</strong> (<em>bool</em><em> (</em><em>optional</em><em>, </em><em>default False</em><em>)</em>) – whether or not to save model to GPU, will check if GPU available</p></li>
<li><p><strong>pretrained_model</strong> (<em>str</em><em> or </em><em>list of strings</em><em> (</em><em>optional</em><em>, </em><em>default False</em><em>)</em>) – path to pretrained cellpose model(s), if False, no model loaded;
if None, built-in ‘cyto’ model loaded</p></li>
<li><p><strong>net_avg</strong> (<em>bool</em><em> (</em><em>optional</em><em>, </em><em>default True</em><em>)</em>) – loads the 4 built-in networks and averages them if True, loads one network if False</p></li>
<li><p><strong>diam_mean</strong> (<em>float</em><em> (</em><em>optional</em><em>, </em><em>default 27.</em><em>)</em>) – mean ‘diameter’, 27. is built in value for ‘cyto’ model</p></li>
<li><p><strong>device</strong> (<em>mxnet device</em><em> (</em><em>optional</em><em>, </em><em>default None</em><em>)</em>) – where model is saved (mx.gpu() or mx.cpu()), overrides gpu input,
recommended if you want to use a specific GPU (e.g. mx.gpu(4))</p></li>
</ul>
</dd>
</dl>
<dl class="method">
<dt id="cellpose.models.CellposeModel.eval">
<code class="sig-name descname">eval</code><span class="sig-paren">(</span><em class="sig-param">imgs</em>, <em class="sig-param">batch_size=8</em>, <em class="sig-param">channels=None</em>, <em class="sig-param">normalize=True</em>, <em class="sig-param">invert=False</em>, <em class="sig-param">rescale=None</em>, <em class="sig-param">diameter=None</em>, <em class="sig-param">do_3D=False</em>, <em class="sig-param">anisotropy=None</em>, <em class="sig-param">net_avg=True</em>, <em class="sig-param">augment=False</em>, <em class="sig-param">tile=True</em>, <em class="sig-param">tile_overlap=0.1</em>, <em class="sig-param">resample=False</em>, <em class="sig-param">interp=True</em>, <em class="sig-param">flow_threshold=0.4</em>, <em class="sig-param">cellprob_threshold=0.0</em>, <em class="sig-param">compute_masks=True</em>, <em class="sig-param">min_size=15</em>, <em class="sig-param">stitch_threshold=0.0</em>, <em class="sig-param">progress=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cellpose/models.html#CellposeModel.eval"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cellpose.models.CellposeModel.eval" title="Permalink to this definition">¶</a></dt>
<dd><p>segment list of images imgs, or 4D array - Z x nchan x Y x X</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>imgs</strong> (<em>list</em><em> or </em><em>array of images</em>) – can be list of 2D/3D/4D images, or array of 2D/3D images</p></li>
<li><p><strong>batch_size</strong> (<em>int</em><em> (</em><em>optional</em><em>, </em><em>default 8</em><em>)</em>) – number of 224x224 patches to run simultaneously on the GPU
(can make smaller or bigger depending on GPU memory usage)</p></li>
<li><p><strong>channels</strong> (<em>list</em><em> (</em><em>optional</em><em>, </em><em>default None</em><em>)</em>) – list of channels, either of length 2 or of length number of images by 2.
First element of list is the channel to segment (0=grayscale, 1=red, 2=blue, 3=green).
Second element of list is the optional nuclear channel (0=none, 1=red, 2=blue, 3=green).
For instance, to segment grayscale images, input [0,0]. To segment images with cells
in green and nuclei in blue, input [2,3]. To segment one grayscale image and one
image with cells in green and nuclei in blue, input [[0,0], [2,3]].</p></li>
<li><p><strong>normalize</strong> (<em>bool</em><em> (</em><em>default</em><em>, </em><em>True</em><em>)</em>) – normalize data so 0.0=1st percentile and 1.0=99th percentile of image intensities in each channel</p></li>
<li><p><strong>invert</strong> (<em>bool</em><em> (</em><em>optional</em><em>, </em><em>default False</em><em>)</em>) – invert image pixel intensity before running network</p></li>
<li><p><strong>rescale</strong> (<em>float</em><em> (</em><em>optional</em><em>, </em><em>default None</em><em>)</em>) – resize factor for each image, if None, set to 1.0</p></li>
<li><p><strong>diameter</strong> (<em>float</em><em> (</em><em>optional</em><em>, </em><em>default None</em><em>)</em>) – diameter for each image (only used if rescale is None),
if diameter is None, set to diam_mean</p></li>
<li><p><strong>do_3D</strong> (<em>bool</em><em> (</em><em>optional</em><em>, </em><em>default False</em><em>)</em>) – set to True to run 3D segmentation on 4D image input</p></li>
<li><p><strong>anisotropy</strong> (<em>float</em><em> (</em><em>optional</em><em>, </em><em>default None</em><em>)</em>) – for 3D segmentation, optional rescaling factor (e.g. set to 2.0 if Z is sampled half as dense as X or Y)</p></li>
<li><p><strong>net_avg</strong> (<em>bool</em><em> (</em><em>optional</em><em>, </em><em>default True</em><em>)</em>) – runs the 4 built-in networks and averages them if True, runs one network if False</p></li>
<li><p><strong>augment</strong> (<em>bool</em><em> (</em><em>optional</em><em>, </em><em>default False</em><em>)</em>) – tiles image with overlapping tiles and flips overlapped regions to augment</p></li>
<li><p><strong>tile</strong> (<em>bool</em><em> (</em><em>optional</em><em>, </em><em>default True</em><em>)</em>) – tiles image to ensure GPU/CPU memory usage limited (recommended)</p></li>
<li><p><strong>tile_overlap</strong> (<em>float</em><em> (</em><em>optional</em><em>, </em><em>default 0.1</em><em>)</em>) – fraction of overlap of tiles when computing flows</p></li>
<li><p><strong>resample</strong> (<em>bool</em><em> (</em><em>optional</em><em>, </em><em>default False</em><em>)</em>) – run dynamics at original image size (will be slower but create more accurate boundaries)</p></li>
<li><p><strong>interp</strong> (<em>bool</em><em> (</em><em>optional</em><em>, </em><em>default True</em><em>)</em>) – interpolate during 2D dynamics (not available in 3D)
(in previous versions it was False)</p></li>
<li><p><strong>flow_threshold</strong> (<em>float</em><em> (</em><em>optional</em><em>, </em><em>default 0.4</em><em>)</em>) – flow error threshold (all cells with errors below threshold are kept) (not used for 3D)</p></li>
<li><p><strong>cellprob_threshold</strong> (<em>float</em><em> (</em><em>optional</em><em>, </em><em>default 0.0</em><em>)</em>) – cell probability threshold (all pixels with prob above threshold kept for masks)</p></li>
<li><p><strong>compute_masks</strong> (<em>bool</em><em> (</em><em>optional</em><em>, </em><em>default True</em><em>)</em>) – Whether or not to compute dynamics and return masks.
This is set to False when retrieving the styles for the size model.</p></li>
<li><p><strong>min_size</strong> (<em>int</em><em> (</em><em>optional</em><em>, </em><em>default 15</em><em>)</em>) – minimum number of pixels per mask, can turn off with -1</p></li>
<li><p><strong>stitch_threshold</strong> (<em>float</em><em> (</em><em>optional</em><em>, </em><em>default 0.0</em><em>)</em>) – if stitch_threshold&gt;0.0 and not do_3D, masks are stitched in 3D to return volume segmentation</p></li>
<li><p><strong>progress</strong> (<em>pyqt progress bar</em><em> (</em><em>optional</em><em>, </em><em>default None</em><em>)</em>) – to return progress bar status to GUI</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>masks</strong> (<em>list of 2D arrays, or single 3D array (if do_3D=True)</em>) – labelled image, where 0=no masks; 1,2,…=mask labels</p></li>
<li><p><strong>flows</strong> (<em>list of lists 2D arrays, or list of 3D arrays (if do_3D=True)</em>) – flows[k][0] = XY flow in HSV 0-255
flows[k][1] = flows at each pixel
flows[k][2] = the cell probability centered at 0.0</p></li>
<li><p><strong>styles</strong> (<em>list of 1D arrays of length 64, or single 1D array (if do_3D=True)</em>) – style vector summarizing each image, also used to estimate size of objects in image</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="cellpose.models.CellposeModel.loss_fn">
<code class="sig-name descname">loss_fn</code><span class="sig-paren">(</span><em class="sig-param">lbl</em>, <em class="sig-param">y</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cellpose/models.html#CellposeModel.loss_fn"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cellpose.models.CellposeModel.loss_fn" title="Permalink to this definition">¶</a></dt>
<dd><p>loss function between true labels lbl and prediction y</p>
</dd></dl>

<dl class="method">
<dt id="cellpose.models.CellposeModel.train">
<code class="sig-name descname">train</code><span class="sig-paren">(</span><em class="sig-param">train_data</em>, <em class="sig-param">train_labels</em>, <em class="sig-param">train_files=None</em>, <em class="sig-param">test_data=None</em>, <em class="sig-param">test_labels=None</em>, <em class="sig-param">test_files=None</em>, <em class="sig-param">channels=None</em>, <em class="sig-param">normalize=True</em>, <em class="sig-param">pretrained_model=None</em>, <em class="sig-param">save_path=None</em>, <em class="sig-param">save_every=100</em>, <em class="sig-param">learning_rate=0.2</em>, <em class="sig-param">n_epochs=500</em>, <em class="sig-param">momentum=0.9</em>, <em class="sig-param">weight_decay=1e-05</em>, <em class="sig-param">batch_size=8</em>, <em class="sig-param">rescale=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cellpose/models.html#CellposeModel.train"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cellpose.models.CellposeModel.train" title="Permalink to this definition">¶</a></dt>
<dd><p>train network with images train_data</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>train_data</strong> (<em>list of arrays</em><em> (</em><em>2D</em><em> or </em><em>3D</em><em>)</em>) – images for training</p></li>
<li><p><strong>train_labels</strong> (<em>list of arrays</em><em> (</em><em>2D</em><em> or </em><em>3D</em><em>)</em>) – labels for train_data, where 0=no masks; 1,2,…=mask labels
can include flows as additional images</p></li>
<li><p><strong>train_files</strong> (<em>list of strings</em>) – file names for images in train_data (to save flows for future runs)</p></li>
<li><p><strong>test_data</strong> (<em>list of arrays</em><em> (</em><em>2D</em><em> or </em><em>3D</em><em>)</em>) – images for testing</p></li>
<li><p><strong>test_labels</strong> (<em>list of arrays</em><em> (</em><em>2D</em><em> or </em><em>3D</em><em>)</em>) – labels for test_data, where 0=no masks; 1,2,…=mask labels;
can include flows as additional images</p></li>
<li><p><strong>test_files</strong> (<em>list of strings</em>) – file names for images in test_data (to save flows for future runs)</p></li>
<li><p><strong>channels</strong> (<em>list of ints</em><em> (</em><em>default</em><em>, </em><em>None</em><em>)</em>) – channels to use for training</p></li>
<li><p><strong>normalize</strong> (<em>bool</em><em> (</em><em>default</em><em>, </em><em>True</em><em>)</em>) – normalize data so 0.0=1st percentile and 1.0=99th percentile of image intensities in each channel</p></li>
<li><p><strong>pretrained_model</strong> (<em>string</em><em> (</em><em>default</em><em>, </em><em>None</em><em>)</em>) – path to pretrained_model to start from, if None it is trained from scratch</p></li>
<li><p><strong>save_path</strong> (<em>string</em><em> (</em><em>default</em><em>, </em><em>None</em><em>)</em>) – where to save trained model, if None it is not saved</p></li>
<li><p><strong>save_every</strong> (<em>int</em><em> (</em><em>default</em><em>, </em><em>100</em><em>)</em>) – save network every [save_every] epochs</p></li>
<li><p><strong>learning_rate</strong> (<em>float</em><em> (</em><em>default</em><em>, </em><em>0.2</em><em>)</em>) – learning rate for training</p></li>
<li><p><strong>n_epochs</strong> (<em>int</em><em> (</em><em>default</em><em>, </em><em>500</em><em>)</em>) – how many times to go through whole training set during training</p></li>
<li><p><strong>weight_decay</strong> (<em>float</em><em> (</em><em>default</em><em>, </em><em>0.00001</em><em>)</em>) – </p></li>
<li><p><strong>batch_size</strong> (<em>int</em><em> (</em><em>optional</em><em>, </em><em>default 8</em><em>)</em>) – number of 224x224 patches to run simultaneously on the GPU
(can make smaller or bigger depending on GPU memory usage)</p></li>
<li><p><strong>rescale</strong> (<em>bool</em><em> (</em><em>default</em><em>, </em><em>True</em><em>)</em>) – whether or not to rescale images to diam_mean during training,
if True it assumes you will fit a size model after training or resize your images accordingly,
if False it will try to train the model to be scale-invariant (works worse)</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="sizemodel">
<h2>SizeModel<a class="headerlink" href="#sizemodel" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="cellpose.models.SizeModel">
<em class="property">class </em><code class="sig-prename descclassname">cellpose.models.</code><code class="sig-name descname">SizeModel</code><span class="sig-paren">(</span><em class="sig-param">cp_model</em>, <em class="sig-param">device=None</em>, <em class="sig-param">pretrained_size=None</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cellpose/models.html#SizeModel"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cellpose.models.SizeModel" title="Permalink to this definition">¶</a></dt>
<dd><p>linear regression model for determining the size of objects in image
used to rescale before input to cp_model
uses styles from cp_model</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>cp_model</strong> (<em>UnetModel</em><em> or </em><a class="reference internal" href="#cellpose.models.CellposeModel" title="cellpose.models.CellposeModel"><em>CellposeModel</em></a>) – model from which to get styles</p></li>
<li><p><strong>device</strong> (<em>mxnet device</em><em> (</em><em>optional</em><em>, </em><em>default mx.cpu</em><em>(</em><em>)</em><em>)</em>) – where cellpose model is saved (mx.gpu() or mx.cpu())</p></li>
<li><p><strong>pretrained_size</strong> (<em>str</em>) – path to pretrained size model</p></li>
</ul>
</dd>
</dl>
<dl class="method">
<dt id="cellpose.models.SizeModel.eval">
<code class="sig-name descname">eval</code><span class="sig-paren">(</span><em class="sig-param">imgs=None</em>, <em class="sig-param">styles=None</em>, <em class="sig-param">channels=None</em>, <em class="sig-param">normalize=True</em>, <em class="sig-param">invert=False</em>, <em class="sig-param">augment=False</em>, <em class="sig-param">tile=True</em>, <em class="sig-param">batch_size=8</em>, <em class="sig-param">progress=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cellpose/models.html#SizeModel.eval"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cellpose.models.SizeModel.eval" title="Permalink to this definition">¶</a></dt>
<dd><p>use images imgs to produce style or use style input to predict size of objects in image</p>
<p>Object size estimation is done in two steps:
1. use a linear regression model to predict size from style in image
2. resize image to predicted size and run CellposeModel to get output masks.</p>
<blockquote>
<div><p>Take the median object size of the predicted masks as the final predicted size.</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>imgs</strong> (<em>list</em><em> or </em><em>array of images</em><em> (</em><em>optional</em><em>, </em><em>default None</em><em>)</em>) – can be list of 2D/3D images, or array of 2D/3D images</p></li>
<li><p><strong>styles</strong> (<em>list</em><em> or </em><em>array of styles</em><em> (</em><em>optional</em><em>, </em><em>default None</em><em>)</em>) – styles for images x - if x is None then styles must not be None</p></li>
<li><p><strong>channels</strong> (<em>list</em><em> (</em><em>optional</em><em>, </em><em>default None</em><em>)</em>) – list of channels, either of length 2 or of length number of images by 2.
First element of list is the channel to segment (0=grayscale, 1=red, 2=blue, 3=green).
Second element of list is the optional nuclear channel (0=none, 1=red, 2=blue, 3=green).
For instance, to segment grayscale images, input [0,0]. To segment images with cells
in green and nuclei in blue, input [2,3]. To segment one grayscale image and one
image with cells in green and nuclei in blue, input [[0,0], [2,3]].</p></li>
<li><p><strong>normalize</strong> (<em>bool</em><em> (</em><em>default</em><em>, </em><em>True</em><em>)</em>) – normalize data so 0.0=1st percentile and 1.0=99th percentile of image intensities in each channel</p></li>
<li><p><strong>invert</strong> (<em>bool</em><em> (</em><em>optional</em><em>, </em><em>default False</em><em>)</em>) – invert image pixel intensity before running network</p></li>
<li><p><strong>augment</strong> (<em>bool</em><em> (</em><em>optional</em><em>, </em><em>default False</em><em>)</em>) – tiles image with overlapping tiles and flips overlapped regions to augment</p></li>
<li><p><strong>tile</strong> (<em>bool</em><em> (</em><em>optional</em><em>, </em><em>default True</em><em>)</em>) – tiles image to ensure GPU/CPU memory usage limited (recommended)</p></li>
<li><p><strong>progress</strong> (<em>pyqt progress bar</em><em> (</em><em>optional</em><em>, </em><em>default None</em><em>)</em>) – to return progress bar status to GUI</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>diam</strong> (<em>array, float</em>) – final estimated diameters from images x or styles style after running both steps</p></li>
<li><p><strong>diam_style</strong> (<em>array, float</em>) – estimated diameters from style alone</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="cellpose.models.SizeModel.train">
<code class="sig-name descname">train</code><span class="sig-paren">(</span><em class="sig-param">train_data</em>, <em class="sig-param">train_labels</em>, <em class="sig-param">test_data=None</em>, <em class="sig-param">test_labels=None</em>, <em class="sig-param">channels=None</em>, <em class="sig-param">normalize=True</em>, <em class="sig-param">learning_rate=0.2</em>, <em class="sig-param">n_epochs=10</em>, <em class="sig-param">l2_regularization=1.0</em>, <em class="sig-param">batch_size=8</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cellpose/models.html#SizeModel.train"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cellpose.models.SizeModel.train" title="Permalink to this definition">¶</a></dt>
<dd><p>train size model with images train_data to estimate linear model from styles to diameters</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>train_data</strong> (<em>list of arrays</em><em> (</em><em>2D</em><em> or </em><em>3D</em><em>)</em>) – images for training</p></li>
<li><p><strong>train_labels</strong> (<em>list of arrays</em><em> (</em><em>2D</em><em> or </em><em>3D</em><em>)</em>) – labels for train_data, where 0=no masks; 1,2,…=mask labels
can include flows as additional images</p></li>
<li><p><strong>channels</strong> (<em>list of ints</em><em> (</em><em>default</em><em>, </em><em>None</em><em>)</em>) – channels to use for training</p></li>
<li><p><strong>normalize</strong> (<em>bool</em><em> (</em><em>default</em><em>, </em><em>True</em><em>)</em>) – normalize data so 0.0=1st percentile and 1.0=99th percentile of image intensities in each channel</p></li>
<li><p><strong>n_epochs</strong> (<em>int</em><em> (</em><em>default</em><em>, </em><em>10</em><em>)</em>) – how many times to go through whole training set (taking random patches) for styles for diameter estimation</p></li>
<li><p><strong>l2_regularization</strong> (<em>float</em><em> (</em><em>default</em><em>, </em><em>1.0</em><em>)</em>) – regularize linear model from styles to diameters</p></li>
<li><p><strong>batch_size</strong> (<em>int</em><em> (</em><em>optional</em><em>, </em><em>default 8</em><em>)</em>) – number of 224x224 patches to run simultaneously on the GPU
(can make smaller or bigger depending on GPU memory usage)</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-cellpose.metrics">
<span id="metrics"></span><h2>Metrics<a class="headerlink" href="#module-cellpose.metrics" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="cellpose.metrics.aggregated_jaccard_index">
<code class="sig-prename descclassname">cellpose.metrics.</code><code class="sig-name descname">aggregated_jaccard_index</code><span class="sig-paren">(</span><em class="sig-param">masks_true</em>, <em class="sig-param">masks_pred</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cellpose/metrics.html#aggregated_jaccard_index"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cellpose.metrics.aggregated_jaccard_index" title="Permalink to this definition">¶</a></dt>
<dd><p>AJI = intersection of all matched masks / union of all masks</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>masks_true</strong> (<em>list of ND-arrays</em><em> (</em><em>int</em><em>) or </em><em>ND-array</em><em> (</em><em>int</em><em>)</em>) – where 0=NO masks; 1,2… are mask labels</p></li>
<li><p><strong>masks_pred</strong> (<em>list of ND-arrays</em><em> (</em><em>int</em><em>) or </em><em>ND-array</em><em> (</em><em>int</em><em>)</em>) – ND-array (int) where 0=NO masks; 1,2… are mask labels</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>aji</strong></p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>aggregated jaccard index for each set of masks</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="cellpose.metrics.average_precision">
<code class="sig-prename descclassname">cellpose.metrics.</code><code class="sig-name descname">average_precision</code><span class="sig-paren">(</span><em class="sig-param">masks_true, masks_pred, threshold=[0.5, 0.75, 0.9]</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cellpose/metrics.html#average_precision"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cellpose.metrics.average_precision" title="Permalink to this definition">¶</a></dt>
<dd><p>average precision estimation: AP = TP / (TP + FP + FN)</p>
<p>This function is based heavily on the <em>fast</em> stardist matching functions
(<a class="reference external" href="https://github.com/mpicbg-csbd/stardist/blob/master/stardist/matching.py">https://github.com/mpicbg-csbd/stardist/blob/master/stardist/matching.py</a>)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>masks_true</strong> (<em>list of ND-arrays</em><em> (</em><em>int</em><em>) or </em><em>ND-array</em><em> (</em><em>int</em><em>)</em>) – where 0=NO masks; 1,2… are mask labels</p></li>
<li><p><strong>masks_pred</strong> (<em>list of ND-arrays</em><em> (</em><em>int</em><em>) or </em><em>ND-array</em><em> (</em><em>int</em><em>)</em>) – ND-array (int) where 0=NO masks; 1,2… are mask labels</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>ap</strong> (<em>array [len(masks_true) x len(threshold)]</em>) – average precision at thresholds</p></li>
<li><p><strong>tp</strong> (<em>array [len(masks_true) x len(threshold)]</em>) – number of true positives at thresholds</p></li>
<li><p><strong>fp</strong> (<em>array [len(masks_true) x len(threshold)]</em>) – number of false positives at thresholds</p></li>
<li><p><strong>fn</strong> (<em>array [len(masks_true) x len(threshold)]</em>) – number of false negatives at thresholds</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="cellpose.metrics.boundary_scores">
<code class="sig-prename descclassname">cellpose.metrics.</code><code class="sig-name descname">boundary_scores</code><span class="sig-paren">(</span><em class="sig-param">masks_true</em>, <em class="sig-param">masks_pred</em>, <em class="sig-param">scales</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cellpose/metrics.html#boundary_scores"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cellpose.metrics.boundary_scores" title="Permalink to this definition">¶</a></dt>
<dd><p>boundary precision / recall / Fscore</p>
</dd></dl>

<dl class="function">
<dt id="cellpose.metrics.flow_error">
<code class="sig-prename descclassname">cellpose.metrics.</code><code class="sig-name descname">flow_error</code><span class="sig-paren">(</span><em class="sig-param">maski</em>, <em class="sig-param">dP_net</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cellpose/metrics.html#flow_error"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cellpose.metrics.flow_error" title="Permalink to this definition">¶</a></dt>
<dd><p>error in flows from predicted masks vs flows predicted by network run on image</p>
<p>This function serves to benchmark the quality of masks, it works as follows
1. The predicted masks are used to create a flow diagram
2. The mask-flows are compared to the flows that the network predicted</p>
<p>If there is a discrepancy between the flows, it suggests that the mask is incorrect.
Masks with flow_errors greater than 0.4 are discarded by default. Setting can be
changed in Cellpose.eval or CellposeModel.eval.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>maski</strong> (<em>ND-array</em><em> (</em><em>int</em><em>)</em>) – masks produced from running dynamics on dP_net,
where 0=NO masks; 1,2… are mask labels</p></li>
<li><p><strong>dP_net</strong> (<em>ND-array</em><em> (</em><em>float</em><em>)</em>) – ND flows where dP_net.shape[1:] = maski.shape</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>flow_errors</strong> (<em>float array with length maski.max()</em>) – mean squared error between predicted flows and flows from masks</p></li>
<li><p><strong>dP_masks</strong> (<em>ND-array (float)</em>) – ND flows produced from the predicted masks</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="cellpose.metrics.mask_ious">
<code class="sig-prename descclassname">cellpose.metrics.</code><code class="sig-name descname">mask_ious</code><span class="sig-paren">(</span><em class="sig-param">masks_true</em>, <em class="sig-param">masks_pred</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cellpose/metrics.html#mask_ious"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cellpose.metrics.mask_ious" title="Permalink to this definition">¶</a></dt>
<dd><p>return best-matched masks</p>
</dd></dl>

</div>
<div class="section" id="module-cellpose.dynamics">
<span id="flows-to-masks"></span><h2>Flows to masks<a class="headerlink" href="#module-cellpose.dynamics" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="cellpose.dynamics.follow_flows">
<code class="sig-prename descclassname">cellpose.dynamics.</code><code class="sig-name descname">follow_flows</code><span class="sig-paren">(</span><em class="sig-param">dP</em>, <em class="sig-param">niter=200</em>, <em class="sig-param">interp=True</em>, <em class="sig-param">use_gpu=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cellpose/dynamics.html#follow_flows"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cellpose.dynamics.follow_flows" title="Permalink to this definition">¶</a></dt>
<dd><p>define pixels and run dynamics to recover masks in 2D</p>
<p>Pixels are meshgrid. Only pixels with non-zero cell-probability
are used (as defined by inds)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dP</strong> (<em>float32</em><em>, </em><em>3D</em><em> or </em><em>4D array</em>) – flows [axis x Ly x Lx] or [axis x Lz x Ly x Lx]</p></li>
<li><p><strong>niter</strong> (<em>int</em><em> (</em><em>optional</em><em>, </em><em>default 200</em><em>)</em>) – number of iterations of dynamics to run</p></li>
<li><p><strong>interp</strong> (<em>bool</em><em> (</em><em>optional</em><em>, </em><em>default True</em><em>)</em>) – interpolate during 2D dynamics (not available in 3D)
(in previous versions + paper it was False)</p></li>
<li><p><strong>use_gpu</strong> (<em>bool</em><em> (</em><em>optional</em><em>, </em><em>default False</em><em>)</em>) – use GPU to run interpolated dynamics (faster than CPU)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>p</strong> – final locations of each pixel after dynamics</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>float32, 3D array</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="cellpose.dynamics.get_masks">
<code class="sig-prename descclassname">cellpose.dynamics.</code><code class="sig-name descname">get_masks</code><span class="sig-paren">(</span><em class="sig-param">p</em>, <em class="sig-param">iscell=None</em>, <em class="sig-param">rpad=20</em>, <em class="sig-param">flows=None</em>, <em class="sig-param">threshold=0.4</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cellpose/dynamics.html#get_masks"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cellpose.dynamics.get_masks" title="Permalink to this definition">¶</a></dt>
<dd><p>create masks using pixel convergence after running dynamics</p>
<p>Makes a histogram of final pixel locations p, initializes masks
at peaks of histogram and extends the masks from the peaks so that
they include all pixels with more than 2 final pixels p. Discards
masks with flow errors greater than the threshold.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>p</strong> (<em>float32</em><em>, </em><em>3D</em><em> or </em><em>4D array</em>) – final locations of each pixel after dynamics,
size [axis x Ly x Lx] or [axis x Lz x Ly x Lx].</p></li>
<li><p><strong>iscell</strong> (<em>bool</em><em>, </em><em>2D</em><em> or </em><em>3D array</em>) – if iscell is not None, set pixels that are
iscell False to stay in their original location.</p></li>
<li><p><strong>rpad</strong> (<em>int</em><em> (</em><em>optional</em><em>, </em><em>default 20</em><em>)</em>) – histogram edge padding</p></li>
<li><p><strong>threshold</strong> (<em>float</em><em> (</em><em>optional</em><em>, </em><em>default 0.4</em><em>)</em>) – masks with flow error greater than threshold are discarded
(if flows is not None)</p></li>
<li><p><strong>flows</strong> (<em>float</em><em>, </em><em>3D</em><em> or </em><em>4D array</em><em> (</em><em>optional</em><em>, </em><em>default None</em><em>)</em>) – flows [axis x Ly x Lx] or [axis x Lz x Ly x Lx]. If flows
is not None, then masks with inconsistent flows are removed using
<cite>remove_bad_flow_masks</cite>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>M0</strong> – masks with inconsistent flow masks removed,
0=NO masks; 1,2,…=mask labels,
size [Ly x Lx] or [Lz x Ly x Lx]</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>int, 2D or 3D array</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="cellpose.dynamics.labels_to_flows">
<code class="sig-prename descclassname">cellpose.dynamics.</code><code class="sig-name descname">labels_to_flows</code><span class="sig-paren">(</span><em class="sig-param">labels</em>, <em class="sig-param">files=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cellpose/dynamics.html#labels_to_flows"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cellpose.dynamics.labels_to_flows" title="Permalink to this definition">¶</a></dt>
<dd><p>convert labels (list of masks or flows) to flows for training model</p>
<p>if files is not None, flows are saved to files to be reused</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>labels</strong> (<em>list of ND-arrays</em>) – labels[k] can be 2D or 3D, if [3 x Ly x Lx] then it is assumed that flows were precomputed.
Otherwise labels[k][0] or labels[k] (if 2D) is used to create flows and cell probabilities.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>flows</strong> – flows[k][0] is labels[k], flows[k][1] is cell probability, flows[k][2] is Y flow, and flows[k][3] is X flow</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>list of [4 x Ly x Lx] arrays</p>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt id="cellpose.dynamics.map_coordinates">
<code class="sig-prename descclassname">cellpose.dynamics.</code><code class="sig-name descname">map_coordinates</code><a class="reference internal" href="_modules/cellpose/dynamics.html#map_coordinates"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cellpose.dynamics.map_coordinates" title="Permalink to this definition">¶</a></dt>
<dd><p>bilinear interpolation of image ‘I’ in-place with ycoordinates yc and xcoordinates xc to Y</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>I</strong> (<em>C x Ly x Lx</em>) – </p></li>
<li><p><strong>yc</strong> (<em>ni</em>) – new y coordinates</p></li>
<li><p><strong>xc</strong> (<em>ni</em>) – new x coordinates</p></li>
<li><p><strong>Y</strong> (<em>C x ni</em>) – I sampled at (yc,xc)</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="cellpose.dynamics.masks_to_flows">
<code class="sig-prename descclassname">cellpose.dynamics.</code><code class="sig-name descname">masks_to_flows</code><span class="sig-paren">(</span><em class="sig-param">masks</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cellpose/dynamics.html#masks_to_flows"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cellpose.dynamics.masks_to_flows" title="Permalink to this definition">¶</a></dt>
<dd><p>convert masks to flows using diffusion from center pixel</p>
<p>Center of masks where diffusion starts is defined to be the
closest pixel to the median of all pixels that is inside the
mask. Result of diffusion is converted into flows by computing
the gradients of the diffusion density map.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>masks</strong> (<em>int</em><em>, </em><em>2D</em><em> or </em><em>3D array</em>) – labelled masks 0=NO masks; 1,2,…=mask labels</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>mu</strong> (<em>float, 3D or 4D array</em>) – flows in Y = mu[-2], flows in X = mu[-1].
if masks are 3D, flows in Z = mu[0].</p></li>
<li><p><strong>mu_c</strong> (<em>float, 2D or 3D array</em>) – for each pixel, the distance to the center of the mask
in which it resides</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="cellpose.dynamics.remove_bad_flow_masks">
<code class="sig-prename descclassname">cellpose.dynamics.</code><code class="sig-name descname">remove_bad_flow_masks</code><span class="sig-paren">(</span><em class="sig-param">masks</em>, <em class="sig-param">flows</em>, <em class="sig-param">threshold=0.4</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cellpose/dynamics.html#remove_bad_flow_masks"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cellpose.dynamics.remove_bad_flow_masks" title="Permalink to this definition">¶</a></dt>
<dd><p>remove masks which have inconsistent flows</p>
<p>Uses metrics.flow_error to compute flows from predicted masks
and compare flows to predicted flows from network. Discards
masks with flow errors greater than the threshold.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>masks</strong> (<em>int</em><em>, </em><em>2D</em><em> or </em><em>3D array</em>) – labelled masks, 0=NO masks; 1,2,…=mask labels,
size [Ly x Lx] or [Lz x Ly x Lx]</p></li>
<li><p><strong>flows</strong> (<em>float</em><em>, </em><em>3D</em><em> or </em><em>4D array</em>) – flows [axis x Ly x Lx] or [axis x Lz x Ly x Lx]</p></li>
<li><p><strong>threshold</strong> (<em>float</em><em> (</em><em>optional</em><em>, </em><em>default 0.4</em><em>)</em>) – masks with flow error greater than threshold are discarded.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>masks</strong> – masks with inconsistent flow masks removed,
0=NO masks; 1,2,…=mask labels,
size [Ly x Lx] or [Lz x Ly x Lx]</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>int, 2D or 3D array</p>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt id="cellpose.dynamics.steps2D">
<code class="sig-prename descclassname">cellpose.dynamics.</code><code class="sig-name descname">steps2D</code><a class="reference internal" href="_modules/cellpose/dynamics.html#steps2D"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cellpose.dynamics.steps2D" title="Permalink to this definition">¶</a></dt>
<dd><p>run dynamics of pixels to recover masks in 2D</p>
<p>Euler integration of dynamics dP for niter steps</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>p</strong> (<em>float32</em><em>, </em><em>3D array</em>) – pixel locations [axis x Ly x Lx] (start at initial meshgrid)</p></li>
<li><p><strong>dP</strong> (<em>float32</em><em>, </em><em>3D array</em>) – flows [axis x Ly x Lx]</p></li>
<li><p><strong>inds</strong> (<em>int32</em><em>, </em><em>2D array</em>) – non-zero pixels to run dynamics on [npixels x 2]</p></li>
<li><p><strong>niter</strong> (<em>int32</em>) – number of iterations of dynamics to run</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>p</strong> – final locations of each pixel after dynamics</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>float32, 3D array</p>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt id="cellpose.dynamics.steps3D">
<code class="sig-prename descclassname">cellpose.dynamics.</code><code class="sig-name descname">steps3D</code><a class="reference internal" href="_modules/cellpose/dynamics.html#steps3D"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cellpose.dynamics.steps3D" title="Permalink to this definition">¶</a></dt>
<dd><p>run dynamics of pixels to recover masks in 3D</p>
<p>Euler integration of dynamics dP for niter steps</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>p</strong> (<em>float32</em><em>, </em><em>4D array</em>) – pixel locations [axis x Lz x Ly x Lx] (start at initial meshgrid)</p></li>
<li><p><strong>dP</strong> (<em>float32</em><em>, </em><em>4D array</em>) – flows [axis x Lz x Ly x Lx]</p></li>
<li><p><strong>inds</strong> (<em>int32</em><em>, </em><em>2D array</em>) – non-zero pixels to run dynamics on [npixels x 3]</p></li>
<li><p><strong>niter</strong> (<em>int32</em>) – number of iterations of dynamics to run</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>p</strong> – final locations of each pixel after dynamics</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>float32, 4D array</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="module-cellpose.transforms">
<span id="image-transforms"></span><h2>Image transforms<a class="headerlink" href="#module-cellpose.transforms" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="cellpose.transforms.average_tiles">
<code class="sig-prename descclassname">cellpose.transforms.</code><code class="sig-name descname">average_tiles</code><span class="sig-paren">(</span><em class="sig-param">y</em>, <em class="sig-param">ysub</em>, <em class="sig-param">xsub</em>, <em class="sig-param">Ly</em>, <em class="sig-param">Lx</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cellpose/transforms.html#average_tiles"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cellpose.transforms.average_tiles" title="Permalink to this definition">¶</a></dt>
<dd><p>average results of network over tiles</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>y</strong> (<em>float</em><em>, </em><em>[</em><em>ntiles x nclasses x bsize x bsize</em><em>]</em>) – output of cellpose network for each tile</p></li>
<li><p><strong>ysub</strong> (<em>list</em>) – list of arrays with start and end of tiles in Y of length ntiles</p></li>
<li><p><strong>xsub</strong> (<em>list</em>) – list of arrays with start and end of tiles in X of length ntiles</p></li>
<li><p><strong>Ly</strong> (<em>int</em>) – size of pre-tiled image in Y (may be larger than original image if
image size is less than bsize)</p></li>
<li><p><strong>Lx</strong> (<em>int</em>) – size of pre-tiled image in X (may be larger than original image if
image size is less than bsize)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>yf</strong> – network output averaged over tiles</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>float32, [nclasses x Ly x Lx]</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="cellpose.transforms.make_tiles">
<code class="sig-prename descclassname">cellpose.transforms.</code><code class="sig-name descname">make_tiles</code><span class="sig-paren">(</span><em class="sig-param">imgi</em>, <em class="sig-param">bsize=224</em>, <em class="sig-param">augment=False</em>, <em class="sig-param">tile_overlap=0.1</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cellpose/transforms.html#make_tiles"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cellpose.transforms.make_tiles" title="Permalink to this definition">¶</a></dt>
<dd><p>make tiles of image to run at test-time</p>
<dl class="simple">
<dt>if augmented, tiles are flipped and tile_overlap=2.</dt><dd><ul class="simple">
<li><p>original</p></li>
<li><p>flipped vertically</p></li>
<li><p>flipped horizontally</p></li>
<li><p>flipped vertically and horizontally</p></li>
</ul>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>imgi</strong> (<em>float32</em>) – array that’s nchan x Ly x Lx</p></li>
<li><p><strong>bsize</strong> (<em>float</em><em> (</em><em>optional</em><em>, </em><em>default 224</em><em>)</em>) – size of tiles</p></li>
<li><p><strong>augment</strong> (<em>bool</em><em> (</em><em>optional</em><em>, </em><em>default False</em><em>)</em>) – flip tiles and set tile_overlap=2.</p></li>
<li><p><strong>tile_overlap</strong> (<em>float</em><em> (</em><em>optional</em><em>, </em><em>default 0.1</em><em>)</em>) – fraction of overlap of tiles</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>IMG</strong> (<em>float32</em>) – array that’s ntiles x nchan x bsize x bsize</p></li>
<li><p><strong>ysub</strong> (<em>list</em>) – list of arrays with start and end of tiles in Y of length ntiles</p></li>
<li><p><strong>xsub</strong> (<em>list</em>) – list of arrays with start and end of tiles in X of length ntiles</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="cellpose.transforms.normalize99">
<code class="sig-prename descclassname">cellpose.transforms.</code><code class="sig-name descname">normalize99</code><span class="sig-paren">(</span><em class="sig-param">img</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cellpose/transforms.html#normalize99"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cellpose.transforms.normalize99" title="Permalink to this definition">¶</a></dt>
<dd><p>normalize image so 0.0 is 1st percentile and 1.0 is 99th percentile</p>
</dd></dl>

<dl class="function">
<dt id="cellpose.transforms.normalize_img">
<code class="sig-prename descclassname">cellpose.transforms.</code><code class="sig-name descname">normalize_img</code><span class="sig-paren">(</span><em class="sig-param">img</em>, <em class="sig-param">axis=-1</em>, <em class="sig-param">invert=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cellpose/transforms.html#normalize_img"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cellpose.transforms.normalize_img" title="Permalink to this definition">¶</a></dt>
<dd><p>normalize each channel of the image so that so that 0.0=1st percentile
and 1.0=99th percentile of image intensities</p>
<p>optional inversion</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>img</strong> (<em>ND-array</em><em> (</em><em>at least 3 dimensions</em><em>)</em>) – </p></li>
<li><p><strong>axis</strong> (<em>channel axis to loop over for normalization</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>img</strong> – normalized image of same size</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>ND-array, float32</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="cellpose.transforms.pad_image_ND">
<code class="sig-prename descclassname">cellpose.transforms.</code><code class="sig-name descname">pad_image_ND</code><span class="sig-paren">(</span><em class="sig-param">img0</em>, <em class="sig-param">div=16</em>, <em class="sig-param">extra=1</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cellpose/transforms.html#pad_image_ND"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cellpose.transforms.pad_image_ND" title="Permalink to this definition">¶</a></dt>
<dd><p>pad image for test-time so that its dimensions are a multiple of 16 (2D or 3D)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>img0</strong> (<em>ND-array</em>) – image of size [nchan (x Lz) x Ly x Lx]</p></li>
<li><p><strong>div</strong> (<em>int</em><em> (</em><em>optional</em><em>, </em><em>default 16</em><em>)</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>I</strong> (<em>ND-array</em>) – padded image</p></li>
<li><p><strong>ysub</strong> (<em>array, int</em>) – yrange of pixels in I corresponding to img0</p></li>
<li><p><strong>xsub</strong> (<em>array, int</em>) – xrange of pixels in I corresponding to img0</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="cellpose.transforms.random_rotate_and_resize">
<code class="sig-prename descclassname">cellpose.transforms.</code><code class="sig-name descname">random_rotate_and_resize</code><span class="sig-paren">(</span><em class="sig-param">X</em>, <em class="sig-param">Y=None</em>, <em class="sig-param">scale_range=1.0</em>, <em class="sig-param">xy=(224</em>, <em class="sig-param">224)</em>, <em class="sig-param">do_flip=True</em>, <em class="sig-param">rescale=None</em>, <em class="sig-param">unet=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cellpose/transforms.html#random_rotate_and_resize"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cellpose.transforms.random_rotate_and_resize" title="Permalink to this definition">¶</a></dt>
<dd><p>augmentation by random rotation and resizing</p>
<p>X and Y are lists or arrays of length nimg, with dims channels x Ly x Lx (channels optional)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>X</strong> (<em>LIST of ND-arrays</em><em>, </em><em>float</em>) – list of image arrays of size [nchan x Ly x Lx] or [Ly x Lx]</p></li>
<li><p><strong>Y</strong> (<em>LIST of ND-arrays</em><em>, </em><em>float</em><em> (</em><em>optional</em><em>, </em><em>default None</em><em>)</em>) – list of image labels of size [nlabels x Ly x Lx] or [Ly x Lx]. The 1st channel
of Y is always nearest-neighbor interpolated (assumed to be masks or 0-1 representation).
If Y.shape[0]==3 and not unet, then the labels are assumed to be [cell probability, Y flow, X flow].
If unet, second channel is dist_to_bound.</p></li>
<li><p><strong>scale_range</strong> (<em>float</em><em> (</em><em>optional</em><em>, </em><em>default 1.0</em><em>)</em>) – Range of resizing of images for augmentation. Images are resized by
(1-scale_range/2) + scale_range * np.random.rand()</p></li>
<li><p><strong>xy</strong> (<em>tuple</em><em>, </em><em>int</em><em> (</em><em>optional</em><em>, </em><em>default</em><em> (</em><em>224</em><em>,</em><em>224</em><em>)</em><em>)</em>) – size of transformed images to return</p></li>
<li><p><strong>do_flip</strong> (<em>bool</em><em> (</em><em>optional</em><em>, </em><em>default True</em><em>)</em>) – whether or not to flip images horizontally</p></li>
<li><p><strong>rescale</strong> (<em>array</em><em>, </em><em>float</em><em> (</em><em>optional</em><em>, </em><em>default None</em><em>)</em>) – how much to resize images by before performing augmentations</p></li>
<li><p><strong>unet</strong> (<em>bool</em><em> (</em><em>optional</em><em>, </em><em>default False</em><em>)</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>imgi</strong> (<em>ND-array, float</em>) – transformed images in array [nimg x nchan x xy[0] x xy[1]]</p></li>
<li><p><strong>lbl</strong> (<em>ND-array, float</em>) – transformed labels in array [nimg x nchan x xy[0] x xy[1]]</p></li>
<li><p><strong>scale</strong> (<em>array, float</em>) – amount each image was resized by</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="cellpose.transforms.reshape">
<code class="sig-prename descclassname">cellpose.transforms.</code><code class="sig-name descname">reshape</code><span class="sig-paren">(</span><em class="sig-param">data, channels=[0, 0], chan_first=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cellpose/transforms.html#reshape"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cellpose.transforms.reshape" title="Permalink to this definition">¶</a></dt>
<dd><p>reshape data using channels</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (<em>numpy array that's</em><em> (</em><em>Z x</em><em> ) </em><em>Ly x Lx x nchan</em>) – if data.ndim==8 and data.shape[0]&lt;8, assumed to be nchan x Ly x Lx</p></li>
<li><p><strong>channels</strong> (<em>list of int of length 2</em><em> (</em><em>optional</em><em>, </em><em>default</em><em> [</em><em>0</em><em>,</em><em>0</em><em>]</em><em>)</em>) – First element of list is the channel to segment (0=grayscale, 1=red, 2=blue, 3=green).
Second element of list is the optional nuclear channel (0=none, 1=red, 2=blue, 3=green).
For instance, to train on grayscale images, input [0,0]. To train on images with cells
in green and nuclei in blue, input [2,3].</p></li>
<li><p><strong>invert</strong> (<em>bool</em>) – invert intensities</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>data</strong></p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>numpy array that’s (Z x ) Ly x Lx x nchan (if chan_first==False)</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="cellpose.transforms.reshape_and_normalize_data">
<code class="sig-prename descclassname">cellpose.transforms.</code><code class="sig-name descname">reshape_and_normalize_data</code><span class="sig-paren">(</span><em class="sig-param">train_data</em>, <em class="sig-param">test_data=None</em>, <em class="sig-param">channels=None</em>, <em class="sig-param">normalize=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cellpose/transforms.html#reshape_and_normalize_data"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cellpose.transforms.reshape_and_normalize_data" title="Permalink to this definition">¶</a></dt>
<dd><p>inputs converted to correct shapes for <em>training</em> and rescaled so that 0.0=1st percentile
and 1.0=99th percentile of image intensities in each channel</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>train_data</strong> (<em>list of ND-arrays</em><em>, </em><em>float</em>) – list of training images of size [Ly x Lx], [nchan x Ly x Lx], or [Ly x Lx x nchan]</p></li>
<li><p><strong>test_data</strong> (<em>list of ND-arrays</em><em>, </em><em>float</em><em> (</em><em>optional</em><em>, </em><em>default None</em><em>)</em>) – list of testing images of size [Ly x Lx], [nchan x Ly x Lx], or [Ly x Lx x nchan]</p></li>
<li><p><strong>channels</strong> (<em>list of int of length 2</em><em> (</em><em>optional</em><em>, </em><em>default None</em><em>)</em>) – First element of list is the channel to segment (0=grayscale, 1=red, 2=blue, 3=green).
Second element of list is the optional nuclear channel (0=none, 1=red, 2=blue, 3=green).
For instance, to train on grayscale images, input [0,0]. To train on images with cells
in green and nuclei in blue, input [2,3].</p></li>
<li><p><strong>normalize</strong> (<em>bool</em><em> (</em><em>optional</em><em>, </em><em>True</em><em>)</em>) – normalize data so 0.0=1st percentile and 1.0=99th percentile of image intensities in each channel</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>train_data</strong> (<em>list of ND-arrays, float</em>) – list of training images of size [2 x Ly x Lx]</p></li>
<li><p><strong>test_data</strong> (<em>list of ND-arrays, float (optional, default None)</em>) – list of testing images of size [2 x Ly x Lx]</p></li>
<li><p><strong>run_test</strong> (<em>bool</em>) – whether or not test_data was correct size and is useable during training</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="cellpose.transforms.reshape_train_test">
<code class="sig-prename descclassname">cellpose.transforms.</code><code class="sig-name descname">reshape_train_test</code><span class="sig-paren">(</span><em class="sig-param">train_data</em>, <em class="sig-param">train_labels</em>, <em class="sig-param">test_data</em>, <em class="sig-param">test_labels</em>, <em class="sig-param">channels</em>, <em class="sig-param">normalize</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cellpose/transforms.html#reshape_train_test"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cellpose.transforms.reshape_train_test" title="Permalink to this definition">¶</a></dt>
<dd><p>check sizes and reshape train and test data for training</p>
</dd></dl>

<dl class="function">
<dt id="cellpose.transforms.resize_image">
<code class="sig-prename descclassname">cellpose.transforms.</code><code class="sig-name descname">resize_image</code><span class="sig-paren">(</span><em class="sig-param">img0</em>, <em class="sig-param">Ly=None</em>, <em class="sig-param">Lx=None</em>, <em class="sig-param">rsz=None</em>, <em class="sig-param">interpolation=1</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cellpose/transforms.html#resize_image"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cellpose.transforms.resize_image" title="Permalink to this definition">¶</a></dt>
<dd><p>resize image for computing flows / unresize for computing dynamics</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>img0</strong> (<em>ND-array</em>) – image of size [y x x x nchan] or [Lz x y x x x nchan]</p></li>
<li><p><strong>Ly</strong> (<em>int</em><em>, </em><em>optional</em>) – </p></li>
<li><p><strong>Lx</strong> (<em>int</em><em>, </em><em>optional</em>) – </p></li>
<li><p><strong>rsz</strong> (<em>float</em><em>, </em><em>optional</em>) – resize coefficient(s) for image; if Ly is None then rsz is used</p></li>
<li><p><strong>interpolation</strong> (<em>cv2 interp method</em><em> (</em><em>optional</em><em>, </em><em>default cv2.INTER_LINEAR</em><em>)</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>imgs</strong> – image of size [Ly x Lx x nchan] or [Lz x Ly x Lx x nchan]</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>ND-array</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="cellpose.transforms.unaugment_tiles">
<code class="sig-prename descclassname">cellpose.transforms.</code><code class="sig-name descname">unaugment_tiles</code><span class="sig-paren">(</span><em class="sig-param">y</em>, <em class="sig-param">unet=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cellpose/transforms.html#unaugment_tiles"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cellpose.transforms.unaugment_tiles" title="Permalink to this definition">¶</a></dt>
<dd><p>reverse test-time augmentations for averaging</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>y</strong> (<em>float32</em>) – array that’s ntiles_y x ntiles_x x chan x Ly x Lx where chan = (dY, dX, cell prob)</p></li>
<li><p><strong>unet</strong> (<em>bool</em><em> (</em><em>optional</em><em>, </em><em>False</em><em>)</em>) – whether or not unet output or cellpose output</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>y</strong></p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>float32</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="module-cellpose.plot">
<span id="plot-functions"></span><h2>Plot functions<a class="headerlink" href="#module-cellpose.plot" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="cellpose.plot.disk">
<code class="sig-prename descclassname">cellpose.plot.</code><code class="sig-name descname">disk</code><span class="sig-paren">(</span><em class="sig-param">med</em>, <em class="sig-param">r</em>, <em class="sig-param">Ly</em>, <em class="sig-param">Lx</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cellpose/plot.html#disk"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cellpose.plot.disk" title="Permalink to this definition">¶</a></dt>
<dd><p>returns pixels of disk with radius r and center med</p>
</dd></dl>

<dl class="function">
<dt id="cellpose.plot.image_to_rgb">
<code class="sig-prename descclassname">cellpose.plot.</code><code class="sig-name descname">image_to_rgb</code><span class="sig-paren">(</span><em class="sig-param">img0, channels=[0, 0]</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cellpose/plot.html#image_to_rgb"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cellpose.plot.image_to_rgb" title="Permalink to this definition">¶</a></dt>
<dd><p>image is 2 x Ly x Lx or Ly x Lx x 2 - change to RGB Ly x Lx x 3</p>
</dd></dl>

<dl class="function">
<dt id="cellpose.plot.interesting_patch">
<code class="sig-prename descclassname">cellpose.plot.</code><code class="sig-name descname">interesting_patch</code><span class="sig-paren">(</span><em class="sig-param">mask</em>, <em class="sig-param">bsize=130</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cellpose/plot.html#interesting_patch"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cellpose.plot.interesting_patch" title="Permalink to this definition">¶</a></dt>
<dd><p>get patch of size bsize x bsize with most masks</p>
</dd></dl>

<dl class="function">
<dt id="cellpose.plot.mask_overlay">
<code class="sig-prename descclassname">cellpose.plot.</code><code class="sig-name descname">mask_overlay</code><span class="sig-paren">(</span><em class="sig-param">img</em>, <em class="sig-param">masks</em>, <em class="sig-param">colors=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cellpose/plot.html#mask_overlay"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cellpose.plot.mask_overlay" title="Permalink to this definition">¶</a></dt>
<dd><p>overlay masks on image (set image to grayscale)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>img</strong> (<em>int</em><em> or </em><em>float</em><em>, </em><em>2D</em><em> or </em><em>3D array</em>) – img is of size [Ly x Lx (x nchan)]</p></li>
<li><p><strong>masks</strong> (<em>int</em><em>, </em><em>2D array</em>) – masks where 0=NO masks; 1,2,…=mask labels</p></li>
<li><p><strong>colors</strong> (<em>int</em><em>, </em><em>2D array</em><em> (</em><em>optional</em><em>, </em><em>default None</em><em>)</em>) – size [nmasks x 3], each entry is a color in 0-255 range</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>RGB</strong> – array of masks overlaid on grayscale image</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>uint8, 3D array</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="cellpose.plot.mask_rgb">
<code class="sig-prename descclassname">cellpose.plot.</code><code class="sig-name descname">mask_rgb</code><span class="sig-paren">(</span><em class="sig-param">masks</em>, <em class="sig-param">colors=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cellpose/plot.html#mask_rgb"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cellpose.plot.mask_rgb" title="Permalink to this definition">¶</a></dt>
<dd><p>masks in random rgb colors</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>masks</strong> (<em>int</em><em>, </em><em>2D array</em>) – masks where 0=NO masks; 1,2,…=mask labels</p></li>
<li><p><strong>colors</strong> (<em>int</em><em>, </em><em>2D array</em><em> (</em><em>optional</em><em>, </em><em>default None</em><em>)</em>) – size [nmasks x 3], each entry is a color in 0-255 range</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>RGB</strong> – array of masks overlaid on grayscale image</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>uint8, 3D array</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="cellpose.plot.show_segmentation">
<code class="sig-prename descclassname">cellpose.plot.</code><code class="sig-name descname">show_segmentation</code><span class="sig-paren">(</span><em class="sig-param">fig, img, maski, flowi, channels=[0, 0], file_name=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cellpose/plot.html#show_segmentation"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cellpose.plot.show_segmentation" title="Permalink to this definition">¶</a></dt>
<dd><p>plot segmentation results (like on website)</p>
<p>Can save each panel of figure with file_name option. Use channels option if
img input is not an RGB image with 3 channels.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fig</strong> (<em>matplotlib.pyplot.figure</em>) – figure in which to make plot</p></li>
<li><p><strong>img</strong> (<em>2D</em><em> or </em><em>3D array</em>) – image input into cellpose</p></li>
<li><p><strong>maski</strong> (<em>int</em><em>, </em><em>2D array</em>) – for image k, masks[k] output from Cellpose.eval, where 0=NO masks; 1,2,…=mask labels</p></li>
<li><p><strong>flowi</strong> (<em>int</em><em>, </em><em>2D array</em>) – for image k, flows[k][0] output from Cellpose.eval (RGB of flows)</p></li>
<li><p><strong>channels</strong> (<em>list of int</em><em> (</em><em>optional</em><em>, </em><em>default</em><em> [</em><em>0</em><em>,</em><em>0</em><em>]</em><em>)</em>) – channels used to run Cellpose, no need to use if image is RGB</p></li>
<li><p><strong>file_name</strong> (<em>str</em><em> (</em><em>optional</em><em>, </em><em>default None</em><em>)</em>) – file name of image, if file_name is not None, figure panels are saved</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</div>
</div>


           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2020, Carsen Stringer &amp; Marius Pachitariu.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    <!-- Theme Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-XXXXXXX-1', 'auto');
    
    ga('send', 'pageview');
    </script>

    
   

</body>
</html>